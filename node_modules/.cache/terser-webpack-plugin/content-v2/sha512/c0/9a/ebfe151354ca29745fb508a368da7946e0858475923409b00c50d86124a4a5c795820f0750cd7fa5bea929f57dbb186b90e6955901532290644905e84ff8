{"code":"!function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,\"a\",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p=\"\",o(o.s=0)}([function(t,e,o){\"use strict\";o.r(e);const i=window.AudioContext||window.webkitAudioContext,n=function(t){if(!n.isRecordingSupported())throw new Error(\"Recording is not supported in this browser\");this.state=\"inactive\",this.config=Object.assign({bufferLength:4096,encoderApplication:2049,encoderFrameSize:20,encoderPath:\"./encoder.worker.js\",encoderSampleRate:48e3,leaveStreamOpen:!1,maxBuffersPerPage:40,mediaTrackConstraints:!0,monitorGain:-1,numberOfChannels:1,positionX:0,positionY:0,positionZ:0,recordingGain:1,resampleQuality:3,streamPages:!1,wavBitDepth:16,recorderFrequency:1},t),this.initWorker()};n.isRecordingSupported=function(){return i&&window.navigator&&window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia&&window.WebAssembly},n.prototype.clearStream=function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach(function(t){t.stop()}):this.stream.stop(),delete this.stream),this.audioContext&&(this.audioContext.close(),delete this.audioContext)},n.prototype.encodeBuffers=function(t){if(\"recording\"===this.state){const e=[];for(let o=0;o<t.numberOfChannels;o++)e[o]=t.getChannelData(o);this.encoder.postMessage({command:\"encode\",buffers:e})}},n.prototype.initAudioContext=function(t){return t&&t.context&&(this.audioContext=t.context),this.audioContext||(this.audioContext=new i),this.audioContext},n.prototype.initAudioGraph=function(){const t=this;this.encodeBuffers=function(){delete this.encodeBuffers},this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=function(e){t.encodeBuffers(e.inputBuffer)},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode.type=\"lowshelf\",this.setFrequency(this.config.recorderFrequency),this.pannerNode=this.audioContext.createPanner(),this.setPosition(this.config.positionX,this.config.positionY,this.config.positionZ),this.pannerNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.config.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)},n.prototype.initSourceNode=function(t){const e=this;return t&&t.context?window.Promise.resolve(t):this.stream&&this.sourceNode?window.Promise.resolve(this.sourceNode):window.navigator.mediaDevices.getUserMedia({audio:this.config.mediaTrackConstraints}).then(function(t){return e.stream=t,e.audioContext.createMediaStreamSource(t)})},n.prototype.initWorker=function(){const t=this;this.recordedPages=[],this.totalLength=0,this.encoder=new window.Worker(this.config.encoderPath),this.encoder.addEventListener(\"message\",this.config.streamPages?function(e){t.streamPage(e.data)}:function(e){t.storePage(e.data)})},n.prototype.pause=function(){\"recording\"===this.state&&(this.state=\"paused\",this.onpause())},n.prototype.resume=function(){\"paused\"===this.state&&(this.state=\"recording\",this.onresume())},n.prototype.setRecordingGain=function(t){this.config.recordingGain=t,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(t,this.audioContext.currentTime,.01)},n.prototype.setMonitorGain=function(t){this.config.monitorGain=t,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(t,this.audioContext.currentTime,.01)},n.prototype.setFrequency=function(t){this.config.filterNode=t,this.filterNode&&this.audioContext&&(this.filterNode.frequency.value=t)},n.prototype.setPosition=function(t,e,o){this.config.positionX=t,this.config.positionY=e,this.config.positionZ=o,this.pannerNode&&this.audioContext&&this.pannerNode.setPosition(t,e,o)},n.prototype.start=function(t){if(\"inactive\"===this.state){const e=this,o=JSON.parse(JSON.stringify(e.config));return this.initAudioContext(t),this.initAudioGraph(),this.initSourceNode(t).then(function(t){e.state=\"recording\",e.encoder.postMessage(Object.assign({command:\"init\",originalSampleRate:e.audioContext.sampleRate,wavSampleRate:e.audioContext.sampleRate},o)),e.sourceNode=t,e.sourceNode.connect(e.monitorGainNode),e.sourceNode.connect(e.recordingGainNode),e.sourceNode.connect(e.filterNode),e.sourceNode.connect(e.pannerNode),e.onstart()})}},n.prototype.stop=function(){\"inactive\"!==this.state&&(this.state=\"inactive\",this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:\"done\"}))},n.prototype.storePage=function(t){if(null===t){const t=new Uint8Array(this.totalLength);this.recordedPages.reduce(function(e,o){return t.set(o,e),e+o.length},0),this.ondataavailable(t),this.initWorker(),this.onstop()}else this.recordedPages.push(t),this.totalLength+=t.length},n.prototype.streamPage=function(t){null===t?(this.initWorker(),this.onstop()):this.ondataavailable(t)},n.prototype.ondataavailable=function(){},n.prototype.onpause=function(){},n.prototype.onresume=function(){},n.prototype.onstart=function(){},n.prototype.onstop=function(){},e.default=n}]);","extractedComments":[]}